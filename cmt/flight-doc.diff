3,4c3,7
<     <!--  Keep some of the primary definitions in separate files  -->
<     <!ENTITY globalPrim SYSTEM "globalPrim.xml">
---
> <!--  Following 4 definitions are used to identify diodes  -->
>     <!ENTITY dminusSmall "0">
>     <!ENTITY dplusSmall "1">
>     <!ENTITY dminusLarge "2">
>     <!ENTITY dplusLarge "3">
6,16c9,11
<     <!ENTITY CALMatPrim SYSTEM "CALMatPrim.xml">
<     <!ENTITY CALCountPrim SYSTEM "CALCountPrim.xml">
<     <!ENTITY CALDimPrim SYSTEM "CALDimPrim.xml">
< 
<     <!ENTITY TKRMatPrim SYSTEM "TKRMatPrim.xml">
<     <!ENTITY TKRCountPrim SYSTEM "TKRCountPrim.xml">
<     <!ENTITY TKRDimPrim SYSTEM "TKRDimPrim.xml">
< 
<     <!ENTITY ACDMatPrim SYSTEM "ACDMatPrim.xml">
<     <!ENTITY ACDCountPrim SYSTEM "ACDCountPrim.xml">
<     <!ENTITY ACDDimPrim SYSTEM "ACDDimPrim.xml">
---
> <!--  need these to identify pieces of a tower  -->
>     <!ENTITY TKRdet "0">
>     <!ENTITY CALdet "1">
18,20c13,15
< <gdd CVSid="$Id: flight.xml,v 1.5 2001/03/20 23:51:22 jrb Exp $" DTDversion="2.0" substituted="false">
<   <source inputId="Id: flight.xml,v 1.5 2001/03/20 23:51:22 jrb Exp " creatorId="Id: makeXmlForDoc.cxx,v 1.3 2001/03/27 00:18:15 jrb Exp ">
<     Do not edit! This file automatically created by xmlUtil/v1/src/forDoc.exe  </source>
---
> <gdd CVSid="$Id: flight.xml,v 1.5 2001/03/20 23:51:22 jrb Exp $" DTDversion="1.1">
>   <source inputId="Id: flight.xml,v 1.5 2001/03/20 23:51:22 jrb Exp " creatorId="Id: makeXmlForDoc.cxx,v 1.2 2001/03/13 23:58:06 jrb Exp ">
>     This file automatically created by xml/src/forDoc.cxx  </source>
27a23,25
>         <prim name="modWidth" type="double" uType="length" value="389.7" unitAngle="deg" unitLength="mm">
>           Width of a single CAL-TKR module.
> THIS IS TOO BIG -- NEED NEW CAL NUMBERS        </prim>
32,52d29
<         <prim name="towerCAL" type="double" uType="count" value="0" unitAngle="deg" unitLength="mm">
<           Id field value for CAL
< (within towers)        </prim>
<         <prim name="towerTKR" type="double" uType="count" value="1" unitAngle="deg" unitLength="mm">
<           Id field value for TKR 
< (within towers)        </prim>
<         <prim name="rootLAT" type="double" uType="count" value="0" unitAngle="deg" unitLength="mm">
<           Id field value for LAT        </prim>
<         <prim name="rootPanels" type="double" uType="count" value="1" unitAngle="deg" unitLength="mm">
<           Id field value for solar panels        </prim>
<         <prim name="rootSC" type="double" uType="count" value="2" unitAngle="deg" unitLength="mm">
<           Id field value for spacecraft        </prim>
<         <prim name="LATTowers" type="double" uType="count" value="0" unitAngle="deg" unitLength="mm">
<           id field for towers
< (within LAT)        </prim>
<         <prim name="LATACD" type="double" uType="count" value="1" unitAngle="deg" unitLength="mm">
<           id field for ACD
< (within LAT)        </prim>
<         <prim name="modWidth" type="double" uType="length" value="389.7" unitAngle="deg" unitLength="mm">
<           Width of a single CAL-TKR module.
< THIS IS TOO BIG -- NEED NEW CAL NUMBERS        </prim>
73c50
<       <primCategory name="CALMatPrim">
---
>       <primCategory name="CALprim">
75c52,57
<           Materials used in the calorimeter        </overview>
---
>           <![CDATA[CAL people need to put something real here.  If
> this works the way I think it should, any standard html markup like
> this use of <strong>strong</strong> can
> go here.  Just avoid two right square brackets (]) followed by a
> less-than (>) because that will be interpreted as the end of the
> CDATA section, which is XML's way to say "take this literally". ]]>        </overview>
90,95c72
< Material for space between CAL layers        </prim>
<         <prim name="CALGridMat" type="string" uType="mat" value="Al" unitAngle="deg" unitLength="mm">
<           Material for CAL grid        </prim>
<         <prim name="CALFlangeMat" type="string" uType="mat" value="Al50" unitAngle="deg" unitLength="mm">
<           
< Material for CAL flange
---
> Material for space between CAL layers
97,105c74,75
<       </primCategory>
<       <primCategory name="CALCountPrim">
<         <overview>
<           Counts for replicated objects in the Calorimeter; other
<             integer constants used to keep track of identifiers.        </overview>
<         <prim name="CALnLayer" type="double" uType="count" value="8" unitAngle="deg" unitLength="mm">
<            Number of layers of CAL CsI crystals        </prim>
<         <prim name="nLogPerLayer" type="double" uType="count" value="12" unitAngle="deg" unitLength="mm">
<           Number of crystals per layer within a tower
---
>         <prim name="nLayer" type="double" uType="count" value="8" unitAngle="deg" unitLength="mm">
>            Number of layers of CAL CsI crystals
107,128d76
<         <prim name="logXtal" type="double" uType="count" value="0" unitAngle="deg" unitLength="mm">
<           idField value for CAL log field
< (the CsI crystal)        </prim>
<         <prim name="logDiode" type="double" uType="count" value="1" unitAngle="deg" unitLength="mm">
<           idField value for CAL log field
< (a diode)        </prim>
<         <prim name="diodeMSmall" type="double" uType="count" value="1" unitAngle="deg" unitLength="mm">
<           idField value for diode 
< field (minus, small)        </prim>
<         <prim name="diodePSmall" type="double" uType="count" value="2" unitAngle="deg" unitLength="mm">
<           idField value for diode 
< field (plus, small)        </prim>
<         <prim name="diodeMLarge" type="double" uType="count" value="3" unitAngle="deg" unitLength="mm">
<           idField value for diode 
< field (minus, large)        </prim>
<         <prim name="diodePLarge" type="double" uType="count" value="4" unitAngle="deg" unitLength="mm">
<           idField value for diode
< field (plus, large)        </prim>
<       </primCategory>
<       <primCategory name="CALDimPrim">
<         <overview>
<           Fundamental dimensions of solids and offsets for the Calorimeter        </overview>
165a114,116
>         <prim name="nEltPerLayer" type="double" uType="count" value="12" unitAngle="deg" unitLength="mm">
>           Number of crystals per layer within a tower
>         </prim>
180c131,132
<           Thickness of CAL grid between towers
---
>           
>         Thickness of CAL grid between towers
183a136,137
>         <prim name="CALGridMat" type="string" uType="mat" value="Al" unitAngle="deg" unitLength="mm">
>           Material for CAL grid        </prim>
186a141,144
>         <prim name="CALFlangeMat" type="string" uType="mat" value="Al50" unitAngle="deg" unitLength="mm">
>           
> Material for CAL flange
>         </prim>
188c146
<       <primCategory name="TKRMatPrim">
---
>       <primCategory name="TKRprim">
190c148,154
<           Materials used in the TKR description        </overview>
---
>           <![CDATA[TKR people need to put something real here.  If
> this works the way I think it should, any standard html markup like
> this use of <strong>strong</strong> can
> go here.  Just avoid two right square brackets (]) followed by a
> less-than (>) because that will be interpreted as the end of the
> CDATA section. ]]>        </overview>
>         <!--  Materials used in tracker -->
193c157
<      used in tracker conversion        </prim>
---
>         used in tracker conversion        </prim>
203,245d166
<       </primCategory>
<       <primCategory name="TKRCountPrim">
<         <overview>
<           Counts of objects  and other quantities used to form identifiers
<    within the tracker.        </overview>
<         <prim name="stripPerWafer" type="double" uType="count" value="384" unitAngle="deg" unitLength="mm">
<           Number of strips per wafer        </prim>
<         <prim name="nWaferAcross" type="double" uType="count" value="4" unitAngle="deg" unitLength="mm">
<            Wafers for a layer 
<    within a tower form a square array of this dimension        </prim>
<         <!--  NB Maintainers - The following constants defining the layout of
<      lead in the trays do not  propagate to the section of the
<      file which describes the trays.  They merely act as documentation.
<      At best, the code interpreting this file could check that the
<      description of tracker volumes below is in accord with the 
<      numbers.  In particular, 
<        ** any change to numTrays, numNoLeadTrays or numSuperGlast
<        ** will entail changes to the definition of the 
<        ** tracker volumes.
<  -->
<         <prim name="numTrays" type="double" uType="count" value="19" unitAngle="deg" unitLength="mm">
<           number of trays (one more than number of x-y planes)        </prim>
<         <prim name="numNoCnvTrays" type="double" uType="count" value="3" unitAngle="deg" unitLength="mm">
<           number of trays 
<     with no converter.  These trays have the lowest tray number        </prim>
<         <prim name="numSuperGlast" type="double" uType="count" value="4" unitAngle="deg" unitLength="mm">
<           number of trays 
<     with super-Glast thickness converter.  These are immediately above
<     the no-lead trays        </prim>
<         <prim name="nFeChips" type="double" uType="count" value="7" unitAngle="deg" unitLength="mm">
<           Number of front-end readout strips per die
< (determines number of Si strips)
<           </prim>
<         <prim name="TKRSiBottom" type="double" uType="count" value="0" unitAngle="deg" unitLength="mm">
<           Field value for Si field
< (bottom of tray)         </prim>
<         <prim name="TKRSiTop" type="double" uType="count" value="1" unitAngle="deg" unitLength="mm">
<           Field value for Si field
< (top of tray)         </prim>
<       </primCategory>
<       <primCategory name="TKRDimPrim">
<         <overview>
<           Fundamental solid dimensions and offsets within the Tracker.        </overview>
289a211,234
>         <prim name="stripPerWafer" type="double" uType="count" value="384" unitAngle="deg" unitLength="mm">
>           Number of strips per wafer        </prim>
>         <prim name="nWaferAcross" type="double" uType="count" value="4" unitAngle="deg" unitLength="mm">
>            Wafers for a layer within a tower
> form a square array of this dimension        </prim>
>         <!--  NB Maintainers - The following constants defining the layout of
>      lead in the trays do not  propagate to the section of the
>      file which describes the trays.  They merely act as documentation.
>      At best, the code interpreting this file could check that the
>      description of tracker volumes below is in accord with the 
>      numbers.  In particular, 
>        ** any change to numTrays, numNoLeadTrays or numSuperGlast
>        ** will entail changes to the definition of the 
>        ** tracker volumes.
>  -->
>         <prim name="numTrays" type="double" uType="count" value="19" unitAngle="deg" unitLength="mm">
>           number of trays (one more than number of x-y planes)        </prim>
>         <prim name="numNoCnvTrays" type="double" uType="count" value="3" unitAngle="deg" unitLength="mm">
>           number of trays 
>          with no converter.  These trays have the lowest tray number        </prim>
>         <prim name="numSuperGlast" type="double" uType="count" value="4" unitAngle="deg" unitLength="mm">
>           number of trays 
>        with super-Glast thickness converter.  These are immediately above
>           the no-lead trays        </prim>
305a251,254
>         <prim name="nFeChips" type="double" uType="count" value="7" unitAngle="deg" unitLength="mm">
>           Number of front-end readout strips per die
> (determines number of Si strips)
>         </prim>
310c259
<       <primCategory name="ACDMatPrim">
---
>       <primCategory name="ACDprim">
312c261,266
<           Materials used in the ACD description        </overview>
---
>           <![CDATA[ACD people should review this to make sure 
> constants from Heather's note have been transcribed correctly.
> Note <font color="#ff0000">some of these values are invented and
> need to be replaced with something real</font>, in particular we're missing
> a sensible number for ACDSupportThickness and a real  support material.
>  ]]>        </overview>
315a270,271
>         <prim name="tileThickness" type="double" uType="length" value="10.0" unitAngle="deg" unitLength="mm">
>           Thickness of ACD tiles        </prim>
319,362d274
<         <prim name="tapeMat" type="string" uType="mat" value="Polystyrene" unitAngle="deg" unitLength="mm">
<           
< Material for scintillating tape        </prim>
<       </primCategory>
<       <primCategory name="ACDCountPrim">
<         <overview>
<           Counts of objects  and other quantities used to form identifiers
<    within the ACD.        </overview>
<         <prim name="numXTopTiles" type="double" uType="count" value="5" unitAngle="deg" unitLength="mm">
<           Number of tiles
< across top in x direction        </prim>
<         <prim name="numYTopTiles" type="double" uType="count" value="5" unitAngle="deg" unitLength="mm">
<           Number of tiles
< across top in y direction        </prim>
<         <prim name="numSideTapes" type="double" uType="count" value="4" unitAngle="deg" unitLength="mm">
<           Number of
< gaps (long axis = Z) to be covered by scintillating tape on each side
< o the ACD.  Should this be derived from #tiles in some side row?        </prim>
<         <prim name="numSideRows" type="double" uType="count" value="4" unitAngle="deg" unitLength="mm">
<           Number of rows of 
< tiles along the sides        </prim>
<         <prim name="numPerSideRowShort" type="double" uType="count" value="5" unitAngle="deg" unitLength="mm">
<           Number of
<   tiles in some (currently upper two) side rows        </prim>
<         <prim name="numPerSideRowLong" type="double" uType="count" value="10" unitAngle="deg" unitLength="mm">
<           Number of
<   tiles in some (currently lower two) side rows        </prim>
<         <!--  assign idfield values for sides and top of ACD -->
<         <prim name="ACDTopFace" type="double" uType="count" value="0" unitAngle="deg" unitLength="mm">
<           Top of ACD        </prim>
<         <prim name="ACDXNegFace" type="double" uType="count" value="1" unitAngle="deg" unitLength="mm">
<           Neg. x face        </prim>
<         <prim name="ACDYNegFace" type="double" uType="count" value="2" unitAngle="deg" unitLength="mm">
<           Neg. y face        </prim>
<         <prim name="ACDXPosFace" type="double" uType="count" value="3" unitAngle="deg" unitLength="mm">
<           Pos. x face        </prim>
<         <prim name="ACDYPosFace" type="double" uType="count" value="4" unitAngle="deg" unitLength="mm">
<           Pos. y face        </prim>
<       </primCategory>
<       <primCategory name="ACDDimPrim">
<         <overview>
<           Fundamental solid dimensions and offsets within the ACD.        </overview>
<         <prim name="tileThickness" type="double" uType="length" value="10.0" unitAngle="deg" unitLength="mm">
<           Thickness of ACD tiles        </prim>
376a289,294
>         <prim name="numXTopTiles" type="double" uType="count" value="5" unitAngle="deg" unitLength="mm">
>           Number of tiles
> across top in x direction        </prim>
>         <prim name="numYTopTiles" type="double" uType="count" value="5" unitAngle="deg" unitLength="mm">
>           Number of tiles
> across top in y direction        </prim>
382a301,305
>         <prim name="numSideTapes" type="double" uType="count" value="4" unitAngle="deg" unitLength="mm">
>           Number of
> gaps (long axis = Z) to be covered by scintillating tape on each side
> o the ACD.  Should this be derived from #tiles in some side row?        </prim>
>         <!--  side stuff -->
386a310,318
>         <prim name="numSideRows" type="double" uType="count" value="4" unitAngle="deg" unitLength="mm">
>           Number of rows of 
> tiles along the sides        </prim>
>         <prim name="numPerSideRowShort" type="double" uType="count" value="5" unitAngle="deg" unitLength="mm">
>           Number of
>   tiles in some (currently upper two) side rows        </prim>
>         <prim name="numPerSideRowLong" type="double" uType="count" value="10" unitAngle="deg" unitLength="mm">
>           Number of
>   tiles in some (currently lower two) side rows        </prim>
407a340,343
>         <!--  tape stuff -->
>         <prim name="tapeMat" type="string" uType="mat" value="Polystyrene" unitAngle="deg" unitLength="mm">
>           
> Material for scintillating tape        </prim>
409c345,346
<           Thickness of scintillating tape        </prim>
---
>           Thickness of scintillating
> tape        </prim>
420c357
<     <derived evaluated="true">
---
>     <derived>
454c391
<       max(CsIEnvX, nLogPerLayer*CsIEnvY), which ends up being
---
>       max(CsIEnvX, nEltPerLayer*CsIEnvY), which ends up being
558,563d494
<         <const name="CALMaxLayer" uType="count" value="7" unitAngle="deg" unitLength="mm" />
<         <const name="nLadderM1" uType="count" value="3" unitAngle="deg" unitLength="mm" />
<         <const name="maxLog" uType="count" value="11" unitAngle="deg" unitLength="mm" />
<         <const name="maxTray" uType="count" value="18" unitAngle="deg" unitLength="mm" />
<         <const name="maxTrayM1" uType="count" value="17" unitAngle="deg" unitLength="mm" />
<         <const name="maxWaferStripNum" uType="count" value="383" unitAngle="deg" unitLength="mm" />
890,1040d820
<   <idDict major="1" minor="0" patch="0" substituted="false">
<     <idRoot name="topObjects">
<       <vConstraints min="0">
<         <fValREF refTo="rootLAT" />
<         <fValREF refTo="rootPanels" />
<         <fValREF refTo="rootSC" />
<       </vConstraints>
<     </idRoot>
<     <field name="fLATObjects">
<       <vConstraints min="0">
<         <fValREF refTo="LATTowers" />
<         <fValREF refTo="LATACD" />
<       </vConstraints>
<     </field>
<     <field name="fTowerY">
<       <vConstraints min="0" maxREF="yNumM1" />
<     </field>
<     <field name="fTowerX">
<       <vConstraints min="0" maxREF="xNumM1" />
<     </field>
<     <field name="fTowerObjects">
<       <vConstraints min="0">
<         <fValREF refTo="towerTKR" />
<         <fValREF refTo="towerCAL" />
<       </vConstraints>
<     </field>
<     <field name="fLayer" />
<     <field name="fCALLog">
<       <vConstraints min="0" maxREF="maxLog" />
<     </field>
<     <field name="fCALLogCmp">
<       <vConstraints min="0">
<         <fValREF refTo="logXtal" />
<         <fValREF refTo="logDiode" />
<       </vConstraints>
<     </field>
<     <field name="fCALLogDiode">
<       <vConstraints min="0">
<         <fValREF refTo="diodeMSmall" />
<         <fValREF refTo="diodePSmall" />
<         <fValREF refTo="diodeMLarge" />
<         <fValREF refTo="diodePLarge" />
<       </vConstraints>
<     </field>
<     <field name="fACDFace">
<       <vConstraints min="0" maxREF="ACDYPosFace" minREF="ACDTopFace" />
<     </field>
<     <field name="fLadder">
<       <vConstraints min="0" maxREF="nLadderM1" />
<     </field>
<     <!--  constraints for these depend on which side we're in -->
<     <field name="fRow" />
<     <field name="fCol" />
<     <field name="fTKRTray">
<       <vConstraints min="0" maxREF="maxTray" />
<     </field>
<     <field name="fTKRSi">
<       <vConstraints min="0">
<         <fValREF refTo="TKRSiBottom" />
<         <fValREF refTo="TKRSiTop" />
<       </vConstraints>
<     </field>
<     <!--  subsequences to conveniently refer to each subdetector -->
<     <absSubseq name="absSubCAL">
<       <theIdRoot>
<         <vConstraints min="0" mustbeREF="LAT" />
<       </theIdRoot>
<       <fieldRef refTo="fLATObjects">
<         <vConstraints min="0" mustbeREF="LATTowers" />
<       </fieldRef>
<       <fieldRef refTo="fTowerY" />
<       <fieldRef refTo="fTowerX" />
<       <fieldRef refTo="fTowerObjects">
<         <vConstraints min="0" mustbeREF="towerCAL" />
<       </fieldRef>
<     </absSubseq>
<     <absSubseq name="absSubTKR">
<       <theIdRoot>
<         <vConstraints min="0" mustbeREF="LAT" />
<       </theIdRoot>
<       <fieldRef refTo="fLATObjects">
<         <vConstraints min="0" mustbeREF="LATTowers" />
<       </fieldRef>
<       <fieldRef refTo="fTowerY" />
<       <fieldRef refTo="fTowerX" />
<       <fieldRef refTo="fTowerObjects">
<         <vConstraints min="0" mustbeREF="towerTKR" />
<       </fieldRef>
<     </absSubseq>
<     <absSubseq name="absSubACD">
<       <theIdRoot>
<         <vConstraints min="0" mustbeREF="LAT" />
<       </theIdRoot>
<       <fieldRef refTo="fLATObjects">
<         <vConstraints min="0" mustbeREF="LATACD" />
<       </fieldRef>
<     </absSubseq>
<     <!--  Sequence to represent a CAL crystal.  May want to add segment
<      for energy accounting. -->
<     <seq name="seqLogXtal">
<       <absSubRef refTo="absSubCAL" />
<       <fieldRef refTo="fLayer">
<         <vConstraints min="0" maxREF="CALMaxLayer" />
<       </fieldRef>
<       <fieldRef refTo="fCALLog" />
<       <fieldRef refTo="fCALLogCmp">
<         <vConstraints min="0" mustbeREF="logXtal" />
<       </fieldRef>
<     </seq>
<     <!--  Sequence to represent a CAL diode. -->
<     <seq name="seqLogDiode">
<       <absSubRef refTo="absSubCAL" />
<       <fieldRef refTo="fLayer">
<         <vConstraints min="0" maxREF="CALMaxLayer" />
<       </fieldRef>
<       <fieldRef refTo="fCALLog" />
<       <fieldRef refTo="fCALLogCmp">
<         <vConstraints min="0" mustbeREF="logDiode" />
<       </fieldRef>
<       <fieldRef refTo="fCALLogDiode" />
<     </seq>
<     <!--  Sequences to represent top or bottom Si on a tray -->
<     <seq name="seqTKRTop">
<       <!--  top tray has only bottom si -->
<       <absSubRef refTo="absSubTKR" />
<       <fieldRef refTo="fTKRTray">
<         <vConstraints min="0" mustbeREF="maxTray" />
<       </fieldRef>
<       <fieldRef refTo="fTKRSi">
<         <vConstraints min="0" mustbeREF="TKRSiBottom" />
<       </fieldRef>
<     </seq>
<     <seq name="seqTKRBottom">
<       <!--  bottom tray has only bottom si -->
<       <absSubRef refTo="absSubTKR" />
<       <fieldRef refTo="fTKRTray">
<         <vConstraints min="0" mustbe="0" />
<       </fieldRef>
<       <fieldRef refTo="fTKRSi">
<         <vConstraints min="0" mustbeREF="TKRSiTop" />
<       </fieldRef>
<     </seq>
<     <seq name="seqTKRinterior">
<       <!--  bottom tray has only bottom si -->
<       <absSubRef refTo="absSubTKR" />
<       <fieldRef refTo="fTKRTray">
<         <vConstraints min="1" maxREF="maxTrayM1" />
<       </fieldRef>
<       <fieldRef refTo="fTKRSi" />
<     </seq>
<   </idDict>
