<!-- $Header: /nfs/slac/g/glast/ground/cvs/xmlUtil/xml/flightTKROneTkr.xml,v 1.4 2001/10/30 00:43:23 jrb Exp $ -->
<!-- Definition of one tower's worth of tracker for flight instrument -->

<!-- Tracker stuff.  The tracker consists of trays.  Alternate trays
     are rotated by 90 degrees with just vacuum inbetween.  But
     the rotation is not apparent to the simulator since it
     doesn't know about individual strips  -->
<!-- Stay-clear envelope -->
    <box name="TKRStayClearBox"
       XREF="TKRTransverseStayClear"
       YREF="TKRTransverseStayClear"
       ZREF="TKRVertStayClear"
       materialREF="vacuumMat" />



<!-- make double stack (first Y, then X) of converter squares, each of
     which is centered over a wafer.  Do it once for regular converter
     thickness and once for superGLAST layers -->
    <box name="convRegSquare"
         XREF="SiWaferActiveSide"
         YREF="SiWaferActiveSide"
         ZREF="convThickReg"
         materialREF="convMat" />

    <stackY name="convRegLadder" >
      <axisMPos volume="convRegSquare" ncopyREF="nWaferAcross"
                                       shiftREF="waferPitch">
        <idField name="fWafer" value="0" step="1" />
      </axisMPos>
    </stackY>

    <stackX name="convRegArray"  >
      <axisMPos volume="convRegLadder" ncopyREF="nWaferAcross"
                                       shiftREF="ladderPitch" >
        <idField name="fLadder" value="0" step="1" />
      </axisMPos>
    </stackX>

    <box name="convSuperSquare"
         XREF="SiWaferActiveSide"
         YREF="SiWaferActiveSide"
         ZREF="convThickSup"
         materialREF="convMat" />

    <stackY name="convSuperLadder" >
      <axisMPos volume="convSuperSquare" ncopyREF="nWaferAcross"
                                         shiftREF="waferPitch">
        <idField name="fWafer" value="0" step="1" />
      </axisMPos>
    </stackY>

    <stackX name="convSuperArray"  >
      <axisMPos volume="convSuperLadder" ncopyREF="nWaferAcross"
                                         shiftREF="ladderPitch" >
        <idField name="fLadder" value="0" step="1" />
      </axisMPos>
    </stackX>


<!-- Now make all the other elements we need for TKR:
     * Core composition for inner layers, including  TKRCoreReg
       core and surrounding closeout              
     * Core comp. for outer (top and bottom) layers  TKRCoreOuter
     * bias board box (include glue to attach Si)    TKRBiasBox
     * face sheet for regular layers, includes glue  TKRFaceReg
       attaching to closeout/core
     * face sheet for superGLAST layers, includes    TKRFaceSup
       glue attaching to closeout/core
     * glue box of "default" thickness (.100 mm);    TKRGlueDef
       that is, glue not touching Si or core.
     * SiLayer (Actually a choice element.  Most applications want
       a detailed view with individual wafers, but someone might
       be happy with just a slab of silicon.)
 -->
    <box name="TKRCoreRegEnv"
	 XREF="TKRTrayWidth" 
	 YREF="TKRTrayWidth" 
	 ZREF="coreThick" 
         materialREF="vacuumMat" />        

    <box name="TKRCoreOuterEnv"
	 XREF="TKRTrayWidth" 
	 YREF="TKRTrayWidth" 
	 ZREF="coreThickOuter" 
         materialREF="vacuumMat" />        

    <box name="TKRCoreRegBox"
	 XREF="TKRCoreWidth" 
	 YREF="TKRCoreWidth" 
	 ZREF="coreThick" 
	 materialREF="coreMat" />

    <box name="TKRCoreOuterBox" 
	 XREF="TKRCoreWidth" 
	 YREF="TKRCoreWidth"
	 ZREF="coreThickOuter" materialREF="coreMat" />

<!-- Define boxes for short and long closeout pieces, both regular
     and outer, so 4 boxes altogether. -->
    <box name="TKRCloseoutRegLong"
         XREF="TKRCloseoutLen"
         YREF="TKRCloseoutWidth"
         ZREF="TKRCloseoutThick"
         materialREF="TKRCloseoutMat" />

    <box name="TKRCloseoutRegShort"
         XREF="TKRCloseoutLenShort"
         YREF="TKRCloseoutWidth"
         ZREF="TKRCloseoutThick"
         materialREF="TKRCloseoutMat" />

    <box name="TKRCloseoutOuterLong"
         XREF="TKRCloseoutLen"
         YREF="TKRCloseoutWidth"
         ZREF="TKRCloseoutThickOuter"
         materialREF="TKRCloseoutMat" />

    <box name="TKRCloseoutOuterShort"
         XREF="TKRCloseoutLenShort"
         YREF="TKRCloseoutWidth"
         ZREF="TKRCloseoutThickOuter"
         materialREF="TKRCloseoutMat" />


<!-- Now make the two compositions needed for core+closeout -->

    <composition name="TKRCoreReg" envelope="TKRCoreRegEnv">
      <posXYZ volume="TKRCoreRegBox" />
      <posXYZ volume="TKRCloseoutRegLong"
              YREF="TKRCloseout_dt" />
      <posXYZ volume="TKRCloseoutRegLong"
              YREF="TKRCloseout_dtn" />
      <posXYZ volume="TKRCloseoutRegShort"
              zrot="90"
              XREF="TKRCloseout_dt" />
      <posXYZ volume="TKRCloseoutRegShort"
              zrot="90"
              XREF="TKRCloseout_dtn" />
    </composition>

<!-- Now same thing for outer tray cores -->
    <composition name="TKRCoreOuter" envelope="TKRCoreOuterEnv">
      <posXYZ volume="TKRCoreOuterBox" />
      <posXYZ volume="TKRCloseoutOuterLong"
              YREF="TKRCloseout_dt" />
      <posXYZ volume="TKRCloseoutOuterLong"
              YREF="TKRCloseout_dtn" />
      <posXYZ volume="TKRCloseoutOuterShort"
              zrot="90"
              XREF="TKRCloseout_dt" />
      <posXYZ volume="TKRCloseoutOuterShort"
              zrot="90"
              XREF="TKRCloseout_dtn" />
    </composition>


<!--    ***   -->  
     
    <box name="SiLayerBox"
         sensitive="true"  
	 XREF="TKRTrayWidth" 
	 YREF="TKRTrayWidth"
	 ZREF="SiThick" materialREF="TKRDetMat" />

<!--  Just a single sheet. For convenience make a box the thickness of
      bias board + glue adjacent to Si   -->

    <box name="TKRBiasBox"
         XREF="TKRBiasWidth"
         YREF="TKRBiasWidth"
         ZREF="biasGlueThick"
         materialREF="TKRBiasBoardMat" />

    <box name="TKRFaceReg"
         XREF="faceWidth"
         YREF="faceWidth"
         ZREF="faceGlueRegThick"
         materialREF="TKRFaceMat" />

    <box name="TKRFaceSup"
         XREF="faceWidth"
         YREF="faceWidth"
         ZREF="faceGlueSupThick"
         materialREF="TKRFaceMat" />

    <box name="TKRGlueDef"
         XREF="faceWidth"
         YREF="faceWidth"
         ZREF="glueDefThick"
         materialREF="TKRGlueMat" />
    

  <!-- No explicit material, so vacuum -->
<!-- probably not needed..
    <box name="SiLayerEnv"    
      XREF="TKRTrayWidth"
      YREF="TKRTrayWidth"
      ZREF="SiThick" 
      materialREF="vacuumMat"/>
  -->

<!-- The unrotated wafer is segmented along the x axis, hence measures X,
     hence is an X layer
 
     Active area is not quite a square, but very close.  For now,
     ignore the .02 mm difference between length and width;
     use the shorter dimension for both.
-->
    <box name="SiWaferActive"
         sensitive="true"
	 XREF="SiWaferActiveSide"
	 YREF="SiWaferActiveSide"
	 ZREF="SiThick"
	 materialREF="TKRDetMat">
      <seg axis="X" reason="readout" nSegREF="stripPerWafer" />
    </box>

    <box name="SiWafer"
	 XREF="SiWaferSide"
	 YREF="SiWaferSide"
	 ZREF="SiThick"
	 materialREF="TKRDetMat">
    </box>

    <composition name="SiWaferNest" envelope="SiWafer">
      <posXYZ volume="SiWaferActive" />
    </composition>

   <!--       ************* new stuff (ladders) *************   -->

    <stackY name="ladder" >
      <axisMPos volume="SiWaferNest" ncopyREF="nWaferAcross"
                                     shiftREF="waferPitch" >
         <idField name="fWafer" value="0" step="1" />
      </axisMPos>
    </stackY>

    <stackX name="SiLadders" >
      <axisMPos volume="ladder" ncopyREF="nWaferAcross" 
                                shiftREF="ladderPitch" >
        <idField name="fLadder" value="0" step="1" />
      </axisMPos>
    </stackX>

   <!--       ************* end new stuff (ladders) *************   -->

    
<!-- identify wafers by their position along stack in direction
     of measurement.                                          
     strip id in glastsim style is then 
           local(in wafer)-strip# + strips-per-wafer * wafer-id
 -->

<!-- The collection of wafers is centered in the volume

          don't think this is needed
    <composition name="SiLadders" envelope="SiLayerEnv">
      <posXYZ volume="towerLayerWafers" />
    </composition>
 -->

<!-- Should we even bother with a choice here?  All clients
     probably want the more detailed SiLayerComp structure -->
    <choice name="SiLayer" >  
      <case mode="fastmc" volume="SiLayerBox" />
      <case mode="digi" volume="SiLadders" />
      <case mode="recon" volume="SiLadders" />
      <case mode="propagate" volume="SiLadders" />
    </choice>

<!-- actually includes all inactive materials except core, conv -->
<!-- I think all of the following included in this comment are
     now defunct.

    <box name="TKRFaceUpperReg"  
	 XREF="faceWidth" 
	 YREF="faceWidth" 
	 ZREF="inactiveThickUpperReg" materialREF="TKRFaceMat" />
    <box name="TKRFaceUpperSuper"  
	 XREF="faceWidth" 
	 YREF="faceWidth" 
	 ZREF="inactiveThickUpperSuper" materialREF="TKRFaceMat" />

    <box name="TKRFaceLowerNoCnv"  
	 XREF="faceWidth" 
	 YREF="faceWidth" 
	 ZREF="inactiveThickLowerNoCnv" materialREF="TKRFaceMat" />

    <box name="TKRBelowCnv"  
	 XREF="faceWidth" 
	 YREF="faceWidth" 
	 ZREF="inactiveThickBelowCnv" materialREF="TKRFaceMat" />

    <box name="TKRFaceToCnvSuper"  
	 XREF="faceWidth" 
	 YREF="faceWidth" 
	 ZREF="inactiveThickToCnvSuper" materialREF="TKRFaceMat" />

    <box name="TKRFaceToCnvReg"  
	 XREF="faceWidth" 
	 YREF="faceWidth" 
	 ZREF="inactiveThickToCnvReg" materialREF="TKRFaceMat" />
    <box name="TKRFaceOutside"  
	 XREF="faceWidth" 
	 YREF="faceWidth" 
	 ZREF="inactiveThickOutside" materialREF="TKRFaceMat" />
 -->

<!-- Trays come in 3 flavors: top tray, bottom tray and middle tray.
     These are further subdivided by thickness of converter layer which
     may be any of 
          no converter (bottom and middle trays only)
          super-GLAST thickness (middle only)
          "normal" thickness (middle and top only)  -->

    <!-- Make a stack for the bottom tray -->
    <stackZ name="trayBot" >
      <axisPos volume="TKRFaceReg" />
      <axisPos volume="TKRCoreOuter" />
      <axisPos volume="TKRFaceReg" />
      <axisPos volume="TKRGlueDef" />
      <axisPos volume="TKRBiasBox" />
      <axisPos volume="SiLayer" >
	<idField name="fTKRTrayCmp" valueREF="eTKRSiTop" />
      </axisPos>
    </stackZ>

    <!-- Stack for middle no-lead trays -->
    <stackZ name="trayNoConv" >
      <axisPos volume="SiLayer" >
	<idField name="fTKRTrayCmp" valueREF="eTKRSiBottom" />
      </axisPos>
      <axisPos volume="TKRBiasBox" />
      <axisPos volume="TKRGlueDef" />
      <axisPos volume="TKRFaceReg" />
      <axisPos volume="TKRCoreReg" />
      <axisPos volume="TKRFaceReg" />
      <axisPos volume="TKRGlueDef" />
      <axisPos volume="TKRBiasBox" />
      <axisPos volume="SiLayer" >
	<idField name="fTKRTrayCmp" valueREF="eTKRSiTop" /> 
      </axisPos>
    </stackZ>

    <!-- stack for super-GLAST layers -->
    <stackZ name="traySuper" >
      <axisPos volume="SiLayer" >
	<idField name="fTKRTrayCmp" valueREF="eTKRSiBottom" />
      </axisPos>
      <axisPos volume="TKRBiasBox" />
      <axisPos volume="TKRGlueDef" />
      <axisPos volume="convSuperArray" >
        <idField name="fTKRTrayCmp" valueREF="eTKRCnv" />
      </axisPos>
      <axisPos volume="TKRGlueDef" />
      <axisPos volume="TKRFaceSup" />
      <axisPos volume="TKRCoreReg" />
      <axisPos volume="TKRFaceSup" />
      <axisPos volume="TKRGlueDef" />
      <axisPos volume="TKRBiasBox" />
      <axisPos volume="SiLayer" >
	<idField name="fTKRTrayCmp" valueREF="eTKRSiTop" />
      </axisPos>
    </stackZ>

    <!-- Regular trays other than top -->
    <stackZ name="trayReg" >
      <axisPos volume="SiLayer" >
	<idField name="fTKRTrayCmp" valueREF="eTKRSiBottom" />
      </axisPos>
      <axisPos volume="TKRBiasBox" />
      <axisPos volume="TKRGlueDef" />
      <axisPos volume="convRegArray"  >
        <idField name="fTKRTrayCmp" valueREF="eTKRCnv" />
      </axisPos>
      <axisPos volume="TKRGlueDef" />
      <axisPos volume="TKRFaceReg" />
      <axisPos volume="TKRCoreReg" />
      <axisPos volume="TKRFaceReg" />
      <axisPos volume="TKRGlueDef" />
      <axisPos volume="TKRBiasBox" />
      <axisPos volume="SiLayer" >
	<idField name="fTKRTrayCmp" valueREF="eTKRSiTop" />
      </axisPos>
    </stackZ>

    <!-- top tray -->
    <stackZ name="trayTop" >
      <axisPos volume="SiLayer" >
	<idField name="fTKRTrayCmp" valueREF="eTKRSiBottom" /> 
      </axisPos>
      <axisPos volume="TKRBiasBox" />
      <axisPos volume="TKRGlueDef" />
      <axisPos volume="convRegArray" >
        <idField name="fTKRTrayCmp" valueREF="eTKRCnv" />
      </axisPos> 
      <axisPos volume="TKRGlueDef" />
      <axisPos volume="TKRFaceReg" />
      <axisPos volume="TKRCoreOuter" />
      <axisPos volume="TKRFaceReg" />
    </stackZ>

    <!-- make a tracker by stacking up the trays -->
    <stackZ name="oneTKRStack" >
      <axisPos volume="trayBot" rotation="90" >
	<idField name="fTKRTray" value="0" />
        <idField name="fMeasure" valueREF="eMeasureY" />
      </axisPos>
      <axisPos volume="trayNoConv" gapREF="tray0Gap" >
	<idField name="fTKRTray" value="1" />
        <idField name="fMeasure" valueREF="eMeasureX" />
      </axisPos>
      <axisPos volume="trayNoConv" rotation="90" gapREF="trayNoCnvGap" >
	<idField name="fTKRTray" value="2" />
        <idField name="fMeasure" valueREF="eMeasureY" />
      </axisPos>
      <axisPos volume="traySuper" gapREF="trayNoCnvGap" >
	<idField name="fTKRTray" value="3" />
        <idField name="fMeasure" valueREF="eMeasureX" />
      </axisPos>
      <axisPos volume="traySuper" rotation="90" gapREF="traySuperGap" >
	<idField name="fTKRTray" value="4" />
        <idField name="fMeasure" valueREF="eMeasureY" />
      </axisPos>
      <axisPos volume="traySuper" gapREF="traySuperGap" >
	<idField name="fTKRTray" value="5" />
        <idField name="fMeasure" valueREF="eMeasureX" />
      </axisPos>
      <axisPos volume="traySuper" rotation="90" gapREF="traySuperGap" >
	<idField name="fTKRTray" value="6" />
        <idField name="fMeasure" valueREF="eMeasureY" />
      </axisPos>
      <axisPos volume="trayReg" gapREF="traySuperGap" >
	<idField name="fTKRTray" value="7" />
        <idField name="fMeasure" valueREF="eMeasureX" />
      </axisPos>
      <axisPos volume="trayReg" rotation="90" gapREF="trayRegGap" >
	<idField name="fTKRTray" value="8" />
        <idField name="fMeasure" valueREF="eMeasureY" />
      </axisPos>
      <axisPos volume="trayReg" gapREF="trayRegGap" >
	<idField name="fTKRTray" value="9" />
        <idField name="fMeasure" valueREF="eMeasureX" />
      </axisPos>
      <axisPos volume="trayReg" rotation="90" gapREF="trayRegGap" >
	<idField name="fTKRTray" value="10" />
        <idField name="fMeasure" valueREF="eMeasureY" />
      </axisPos>
      <axisPos volume="trayReg" gapREF="trayRegGap" >
	<idField name="fTKRTray" value="11" />
        <idField name="fMeasure" valueREF="eMeasureX" />
      </axisPos>
      <axisPos volume="trayReg" rotation="90" gapREF="trayRegGap" >
	<idField name="fTKRTray" value="12" />
        <idField name="fMeasure" valueREF="eMeasureY" />
      </axisPos>
      <axisPos volume="trayReg" gapREF="trayRegGap" >
	<idField name="fTKRTray" value="13" />
        <idField name="fMeasure" valueREF="eMeasureX" />
      </axisPos>
      <axisPos volume="trayReg" rotation="90" gapREF="trayRegGap" >
	<idField name="fTKRTray" value="14" />
        <idField name="fMeasure" valueREF="eMeasureY" />
      </axisPos>
      <axisPos volume="trayReg" gapREF="trayRegGap" >
	<idField name="fTKRTray" value="15" />
        <idField name="fMeasure" valueREF="eMeasureX" />
      </axisPos>
      <axisPos volume="trayReg" rotation="90" gapREF="trayRegGap" >
	<idField name="fTKRTray" value="16" />
        <idField name="fMeasure" valueREF="eMeasureY" />
      </axisPos>
      <axisPos volume="trayReg" gapREF="trayRegGap" >
	<idField name="fTKRTray" value="17" />
        <idField name="fMeasure" valueREF="eMeasureX" />
      </axisPos>
      <axisPos volume="trayTop" rotation="90" gapREF="trayRegGap" >
	<idField name="fTKRTray" value="18" />
        <idField name="fMeasure" valueREF="eMeasureY" />
      </axisPos>

    </stackZ>

    <composition name="oneTKR" envelope="TKRStayClearBox">
      <posXYZ volume="oneTKRStack" />
    </composition>

<!--   Obsolete stuff.  Superseded by ladder definitions above because
        only Si is in ladders. 
    <stackZ name="topWafer" >
      <axisPos volume="upperBiasBox" />
      <axisPos volume="SiWaferNest" />
    </stackZ>

    <stackY name="topLadder" >
      <axisMPos volume="topWafer" ncopyREF="nWaferAcross"
                                       shiftREF="waferPitch" >
        <idField name="fWafer" value="0" step="1" />
      </axisMPos>
    </stackY>

    <stackX name="topLadders" >
      <axisMPos volume="topLadder" ncopyREF="nWaferAcross"
                                   shiftREF="ladderPitch" >
        <idField name="fLadder" value="0" step="1" />
      </axisMPos>
    </stackX>

    <stackZ name="botWaferNoCnv" >
      <axisPos volume="SiWaferNest" />
      <axisPos volume="lowerBiasBox" />
    </stackZ>

    <stackY name="botLadderNoCnv" >
      <axisMPos volume="botWaferNoCnv" ncopyREF="nWaferAcross"
                                       shiftREF="waferPitch" >
        <idField name="fWafer" value="0" step="1" />
      </axisMPos>
    </stackY>

    <stackX name="botLaddersNoCnv" >
      <axisMPos volume="botLadderNoCnv" ncopyREF="nWaferAcross"
                                   shiftREF="ladderPitch" >
        <idField name="fLadder" value="0" step="1" />
      </axisMPos>
    </stackX>
-->


<!--
    <box name="lowerBiasBox"
         XREF="SiWaferSide"
         YREF="SiWaferSide"
         ZREF="lowerBiasGlueThick"
         materialREF="TKRBiasBoardMat" />
-->
