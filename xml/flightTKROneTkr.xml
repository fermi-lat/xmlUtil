<!-- $Header: /nfs/slac/g/glast/ground/cvs/xmlUtil/xml/flightTKROneTkr.xml,v 1.2 2001/10/17 23:45:49 jrb Exp $ -->
<!-- Definition of one tower's worth of tracker for flight instrument -->

<!-- Tracker stuff.  The tracker consists of trays.  Alternate trays
     are rotated by 90 degrees with just vacuum inbetween.  But
     the rotation is not apparent to the simulator since it
     doesn't know about individual strips  -->
<!-- Stay-clear envelope -->
    <box name="TKRStayClearBox"
       XREF="TKRTransverseStayClear"
       YREF="TKRTransverseStayClear"
       ZREF="TKRVertStayClear"
       materialREF="vacuumMat" />



<!-- make double stack (first Y, then X) of converter squares, each of
     which is centered over a wafer.  Do it once for regular converter
     thickness and once for superGLAST layers -->
    <box name="convRegSquare"
         XREF="SiWaferActiveSide"
         YREF="SiWaferActiveSide"
         ZREF="convThickReg"
         materialREF="convMat" />

    <stackY name="convRegLadder" >
      <axisMPos volume="convRegSquare" ncopyREF="nWaferAcross"
                                       shiftREF="waferPitch">
        <idField name="fWafer" value="0" step="1" />
      </axisMPos>
    </stackY>

    <stackX name="convRegArray"  >
      <axisMPos volume="convRegLadder" ncopyREF="nWaferAcross"
                                       shiftREF="ladderPitch" >
        <idField name="fLadder" value="0" step="1" />
      </axisMPos>
    </stackX>
        
    <box name="convSuperSquare"
         XREF="SiWaferActiveSide"
         YREF="SiWaferActiveSide"
         ZREF="convThickSup"
         materialREF="convMat" />


    <stackY name="convSuperLadder" >
      <axisMPos volume="convSuperSquare" ncopyREF="nWaferAcross"
                                         shiftREF="waferPitch">
        <idField name="fWafer" value="0" step="1" />
      </axisMPos>
    </stackY>

    <stackX name="convSuperArray"  >
      <axisMPos volume="convSuperLadder" ncopyREF="nWaferAcross"
                                         shiftREF="ladderPitch" >
        <idField name="fLadder" value="0" step="1" />
      </axisMPos>
    </stackX>





    <box name="TKRCoreReg"
	 XREF="TKRTrayWidth" 
	 YREF="TKRTrayWidth" 
	 ZREF="coreThick" 
	 materialREF="coreMat" />
    <box name="TKRCoreOuter" 
	 XREF="TKRTrayWidth" 
	 YREF="TKRTrayWidth"
	 ZREF="coreThickOuter" materialREF="coreMat" />


    <box name="SiLayerBox"
         sensitive="true"  
	 XREF="TKRTrayWidth" 
	 YREF="TKRTrayWidth"
	 ZREF="SiThick" materialREF="TKRDetMat" />


  <!-- No explicit material, so vacuum -->
    <box name="SiLayerEnv"    
      XREF="TKRTrayWidth"
      YREF="TKRTrayWidth"
      ZREF="SiThick" 
      materialREF="vacuumMat"/>

<!-- The unrotated wafer is segmented along the x axis, hence measures X,
     hence is an X layer
 
     Active area is not quite a square, but very close.  For now,
     ignore the .02 mm difference between length and width;
     use the shorter dimension for both.
-->
    <box name="SiWaferActive"
         sensitive="true"
	 XREF="SiWaferActiveSide"
	 YREF="SiWaferActiveSide"
	 ZREF="SiThick"
	 materialREF="TKRDetMat">
      <seg axis="X" reason="readout" nSegREF="stripPerWafer" />
    </box>

    <box name="SiWafer"
	 XREF="SiWaferSide"
	 YREF="SiWaferSide"
	 ZREF="SiThick"
	 materialREF="TKRDetMat">
    </box>

    <composition name="SiWaferNest" envelope="SiWafer">
      <posXYZ volume="SiWaferActive" />
    </composition>
    
<!-- identify wafers by their position along stack in direction
     of measurement.                                          
     strip id in glastsim style is then 
           local(in wafer)-strip# + strips-per-wafer * wafer-id
 -->

<!--       Try stacking in Y first to make a ladder.     -->
    <stackY name="ladder" origin="atCentre" >
      <axisMPos volume="SiWaferNest" ncopyREF="nWaferAcross"
                                     shiftREF="waferPitch" >
         <idField name="fWafer" value="0" step="1" />
      </axisMPos>
    </stackY>

    <stackX name="towerLayerWafers" origin="atCentre" >
      <axisMPos volume="ladder" ncopyREF="nWaferAcross"
                                shiftREF="ladderPitch" >
        <idField name="fLadder" value="0" step="1" />
      </axisMPos>
    </stackX>


<!-- The collection of wafers is centered in the volume -->
    <composition name="SiLayerComp" envelope="SiLayerEnv">
      <posXYZ volume="towerLayerWafers" />
    </composition>

<!-- Should we even bother with a choice here?  All clients
     probably want the more detailed SiLayerComp structure -->
    <choice name="SiLayer" >  
      <case mode="fastmc" volume="SiLayerBox" />
      <case mode="digi" volume="SiLayerComp" />
      <case mode="recon" volume="SiLayerComp" />
      <case mode="propagate" volume="SiLayerComp" />
    </choice>

<!-- actually includes all inactive materials except core, conv -->
    <box name="TKRFaceUpperReg"  
	 XREF="faceWidth" 
	 YREF="faceWidth" 
	 ZREF="inactiveThickUpperReg" materialREF="TKRFaceMat" />
    <box name="TKRFaceUpperSuper"  
	 XREF="faceWidth" 
	 YREF="faceWidth" 
	 ZREF="inactiveThickUpperSuper" materialREF="TKRFaceMat" />

    <box name="TKRFaceLowerNoCnv"  
	 XREF="faceWidth" 
	 YREF="faceWidth" 
	 ZREF="inactiveThickLowerNoCnv" materialREF="TKRFaceMat" />

    <box name="TKRBelowCnv"  
	 XREF="faceWidth" 
	 YREF="faceWidth" 
	 ZREF="inactiveThickBelowCnv" materialREF="TKRFaceMat" />

    <box name="TKRFaceToCnvSuper"  
	 XREF="faceWidth" 
	 YREF="faceWidth" 
	 ZREF="inactiveThickToCnvSuper" materialREF="TKRFaceMat" />

    <box name="TKRFaceToCnvReg"  
	 XREF="faceWidth" 
	 YREF="faceWidth" 
	 ZREF="inactiveThickToCnvReg" materialREF="TKRFaceMat" />
    <box name="TKRFaceOutside"  
	 XREF="faceWidth" 
	 YREF="faceWidth" 
	 ZREF="inactiveThickOutside" materialREF="TKRFaceMat" />


<!-- Trays come in 3 flavors: top tray, bottom tray and middle tray.
     These are further subdivided by thickness of converter layer which
     may be any of 
          no converter (bottom and middle trays only)
          super-GLAST thickness (middle only)
          "normal" thickness (middle and top only)  -->

    <!-- Make a stack for the bottom tray -->
    <stackZ name="trayBot" >
      <axisPos volume="TKRFaceOutside" />
      <axisPos volume="TKRCoreOuter" />
      <axisPos volume="TKRFaceUpperReg" />
      <axisPos volume="SiLayer" >
	<idField name="fTKRTrayCmp" valueREF="eTKRSiTop" />
      </axisPos>
    </stackZ>

    <!-- Stack for middle no-lead trays -->
    <stackZ name="trayNoConv" >
      <axisPos volume="SiLayer" >
	<idField name="fTKRTrayCmp" valueREF="eTKRSiBottom" />
      </axisPos>
      <axisPos volume="TKRFaceLowerNoCnv" />
      <axisPos volume="TKRCoreReg" />
      <axisPos volume="TKRFaceUpperReg" />
      <axisPos volume="SiLayer" >
	<idField name="fTKRTrayCmp" valueREF="eTKRSiTop" /> 
      </axisPos>
    </stackZ>

    <!-- stack for super-GLAST layers -->
    <stackZ name="traySuper" >
      <axisPos volume="SiLayer" >
	<idField name="fTKRTrayCmp" valueREF="eTKRSiBottom" />
      </axisPos>
      <axisPos volume="TKRBelowCnv" />
      <axisPos volume="convSuperArray" >
        <idField name="fTKRTrayCmp" valueREF="eTKRCnv" />
      </axisPos>
      <axisPos volume="TKRFaceToCnvSuper" />
      <axisPos volume="TKRCoreReg" />
      <axisPos volume="TKRFaceUpperSuper" />
      <axisPos volume="SiLayer" >
	<idField name="fTKRTrayCmp" valueREF="eTKRSiTop" />
      </axisPos>
    </stackZ>

    <!-- Regular trays other than top -->
    <stackZ name="trayReg" >
      <axisPos volume="SiLayer" >
	<idField name="fTKRTrayCmp" valueREF="eTKRSiBottom" />
      </axisPos>
      <axisPos volume="TKRBelowCnv" />
      <axisPos volume="convRegArray"  >
        <idField name="fTKRTrayCmp" valueREF="eTKRCnv" />
      </axisPos>
      <axisPos volume="TKRFaceToCnvReg" />
      <axisPos volume="TKRCoreReg" />
      <axisPos volume="TKRFaceUpperReg" />
      <axisPos volume="SiLayer" >
	<idField name="fTKRTrayCmp" valueREF="eTKRSiTop" />
      </axisPos>
    </stackZ>

    <!-- top tray -->
    <stackZ name="trayTop" >
      <axisPos volume="SiLayer" >
	<idField name="fTKRTrayCmp" valueREF="eTKRSiBottom" /> 
      </axisPos>
      <axisPos volume="TKRBelowCnv" />
      <axisPos volume="convRegArray" >
        <idField name="fTKRTrayCmp" valueREF="eTKRCnv" />
      </axisPos> 
      <axisPos volume="TKRFaceToCnvReg" />
      <axisPos volume="TKRCoreOuter" />
      <axisPos volume="TKRFaceOutside" />
    </stackZ>

    <!-- make a tracker by stacking up the trays -->
    <stackZ name="oneTKRStack" >
      <axisPos volume="trayBot" rotation="90" >
	<idField name="fTKRTray" value="0" />
        <idField name="fMeasure" valueREF="eMeasureY" />
      </axisPos>
      <axisPos volume="trayNoConv" gapREF="tray0Gap" >
	<idField name="fTKRTray" value="1" />
        <idField name="fMeasure" valueREF="eMeasureX" />
      </axisPos>
      <axisPos volume="trayNoConv" rotation="90" gapREF="trayNoCnvGap" >
	<idField name="fTKRTray" value="2" />
        <idField name="fMeasure" valueREF="eMeasureY" />
      </axisPos>
      <axisPos volume="traySuper" gapREF="trayNoCnvGap" >
	<idField name="fTKRTray" value="3" />
        <idField name="fMeasure" valueREF="eMeasureX" />
      </axisPos>
      <axisPos volume="traySuper" rotation="90" gapREF="traySuperGap" >
	<idField name="fTKRTray" value="4" />
        <idField name="fMeasure" valueREF="eMeasureY" />
      </axisPos>
      <axisPos volume="traySuper" gapREF="traySuperGap" >
	<idField name="fTKRTray" value="5" />
        <idField name="fMeasure" valueREF="eMeasureX" />
      </axisPos>
      <axisPos volume="traySuper" rotation="90" gapREF="traySuperGap" >
	<idField name="fTKRTray" value="6" />
        <idField name="fMeasure" valueREF="eMeasureY" />
      </axisPos>
      <axisPos volume="trayReg" gapREF="traySuperGap" >
	<idField name="fTKRTray" value="7" />
        <idField name="fMeasure" valueREF="eMeasureX" />
      </axisPos>
      <axisPos volume="trayReg" rotation="90" gapREF="trayRegGap" >
	<idField name="fTKRTray" value="8" />
        <idField name="fMeasure" valueREF="eMeasureY" />
      </axisPos>
      <axisPos volume="trayReg" gapREF="trayRegGap" >
	<idField name="fTKRTray" value="9" />
        <idField name="fMeasure" valueREF="eMeasureX" />
      </axisPos>
      <axisPos volume="trayReg" rotation="90" gapREF="trayRegGap" >
	<idField name="fTKRTray" value="10" />
        <idField name="fMeasure" valueREF="eMeasureY" />
      </axisPos>
      <axisPos volume="trayReg" gapREF="trayRegGap" >
	<idField name="fTKRTray" value="11" />
        <idField name="fMeasure" valueREF="eMeasureX" />
      </axisPos>
      <axisPos volume="trayReg" rotation="90" gapREF="trayRegGap" >
	<idField name="fTKRTray" value="12" />
        <idField name="fMeasure" valueREF="eMeasureY" />
      </axisPos>
      <axisPos volume="trayReg" gapREF="trayRegGap" >
	<idField name="fTKRTray" value="13" />
        <idField name="fMeasure" valueREF="eMeasureX" />
      </axisPos>
      <axisPos volume="trayReg" rotation="90" gapREF="trayRegGap" >
	<idField name="fTKRTray" value="14" />
        <idField name="fMeasure" valueREF="eMeasureY" />
      </axisPos>
      <axisPos volume="trayReg" gapREF="trayRegGap" >
	<idField name="fTKRTray" value="15" />
        <idField name="fMeasure" valueREF="eMeasureX" />
      </axisPos>
      <axisPos volume="trayReg" rotation="90" gapREF="trayRegGap" >
	<idField name="fTKRTray" value="16" />
        <idField name="fMeasure" valueREF="eMeasureY" />
      </axisPos>
      <axisPos volume="trayReg" gapREF="trayRegGap" >
	<idField name="fTKRTray" value="17" />
        <idField name="fMeasure" valueREF="eMeasureX" />
      </axisPos>
      <axisPos volume="trayTop" rotation="90" gapREF="trayRegGap" >
	<idField name="fTKRTray" value="18" />
        <idField name="fMeasure" valueREF="eMeasureY" />
      </axisPos>

    </stackZ>

    <composition name="oneTKR" envelope="TKRStayClearBox">
      <posXYZ volume="oneTKRStack" />
    </composition>