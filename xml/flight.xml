<?xml version="1.0"  ?>

<!--  $Header: /nfs/slac/g/glast/ground/cvs/xmlUtil/xml/flight.xml,v 1.14 2001/12/07 01:34:57 jrb Exp $        -->
<!-- 1 Feb 2001   Default length unit is now mm.  Change constants
                   accordingly.                             (jrb) 
    22 Feb 2001   Add CVS macros, CVSid attribute for gdd     
     1 Mar 2001   Changes for <identifier> to <idField> change in dtd.
                  Includes combining old pair of diode identifier fields
                  into just one and ( *sigh* ) eliminating "orient" field.
-->

<!DOCTYPE gdd SYSTEM "gdd.dtd"
  [
    <!-- Keep some of the primary definitions in separate files -->
    <!ENTITY globalMatPrim   SYSTEM "flightGlobalMatPrim.xml">
    <!ENTITY globalCountPrim SYSTEM "flightGlobalCountPrim.xml">
    <!ENTITY globalDimPrim   SYSTEM "flightGlobalDimPrim.xml">

    <!ENTITY CALMatPrim     SYSTEM "flightCALMatPrim.xml">
    <!ENTITY CALCountPrim   SYSTEM "flightCALCountPrim.xml">
    <!ENTITY CALDimPrim     SYSTEM "flightCALDimPrim.xml">
    <!ENTITY CALOneCal      SYSTEM "flightCALOneCal.xml">

    <!ENTITY TKRMatPrim     SYSTEM "flightTKRMatPrim.xml">
    <!ENTITY TKRCountPrim   SYSTEM "flightTKRCountPrim.xml">
    <!ENTITY TKRDimPrim     SYSTEM "flightTKRDimPrim.xml">
    <!ENTITY TKROneTkr      SYSTEM "flightTKROneTkr.xml">

    <!ENTITY ACDMatPrim     SYSTEM "flightACDMatPrim.xml">
    <!ENTITY ACDCountPrim   SYSTEM "flightACDCountPrim.xml">
    <!ENTITY ACDDimPrim     SYSTEM "flightACDDimPrim.xml">
    <!ENTITY ACDAcd         SYSTEM "flightACDAcd.xml">

    <!ENTITY NADDimPrim     SYSTEM "flightNADDimPrim.xml">

    <!ENTITY Derived        SYSTEM "flightDerivedConstants.xml">
    <!ENTITY Primary        SYSTEM "flightPrimaryConstants.xml">

    <!ENTITY idDict         SYSTEM "flightIdDict.xml">

    <!ENTITY Materials         SYSTEM "flightMaterials.xml">
  ]
>
<gdd CVSid="$Id: flight.xml,v 1.14 2001/12/07 01:34:57 jrb Exp $" 
     DTDversion="2.0" >
  <constants>
    <version major="0" minor="0" />
     &Primary;
     &Derived;
  </constants>
 
  <materials version="0.1" date="071101" author="M.Frailis">
    &Materials;
  </materials>

  &idDict;

  <section name="LATsection"
           version="1.0" date="2001/3/9" author="J.Bogart"
           topVolume="LAT" >
    <!-- (will) include the 16 towers, grid, and ACD
         Each "tower" has a tracker, a calorimeter, and a mechanical
         piece inbetween. (what about electronics?)
         Each tracker consists of trays
         Each tray has 1 (iff top or bottom) or 2 layers of silicon
         and most trays also have a converter layer (can be of
         two possible thicknesses. -->
    <!-- Use conventions as laid out in Steve Ritz's memo.  Z is
    up (perp. to cal. layers and tracker trays).  An "x-strip"
    is one that measures the x-coordinate of the hit, hence its
    length is parallel to the y-axis.  An "x-log", on the other
    hand, has its long axis parallel to the x-axis (but there 
    is some consistency here: logs make their most precise 
    measurement in the direction parallel to their length.) 
    
    Cal layer numbers increase from the front (largest Z value,
    which is 0 for the Cal) to the back (smallest Z).  Layer 0 
    has x-logs;  layer 7, the last layer, has y-logs.  
    
    Tracker trays and layers are numbered from back to front,
    i.e. increase with increasing Z.  All strips associated
    with a tray (i.e., front side and back side, if the tray 
    is one that has both) have the same orientation.  Even-numbered
    trays have Y-strips and odd-numbered trays have X-strips.

    -->
<!--
    <box name="LATenv"
         XREF="LATX" YREF="LATY" ZREF="LATZ" />
 -->
    <box name="LATenv" 
         XREF="bigDim" YREF="bigDim" ZREF="bigDim" />


&CALOneCal;
&TKROneTkr;

<!-- Define boxes for blanket:  top, X-side and Y-side -->
    <box name="blanketTop" 
         XREF="NADBlanketTopX" YREF="NADBlanketTopY" 
         ZREF="NADBlanketThick" materialREF="blanketMat" />
      
    <box name="blanketXSide" 
         XREF="NADBlanketSideX" YREF="NADBlanketThick" 
         ZREF="NADBlanketSideZ" materialREF="blanketMat" />
      
    <box name="blanketYSide" 
         XREF="NADBlanketThick" YREF="NADBlanketSideY" 
         ZREF="NADBlanketSideZ" materialREF="blanketMat" />
      
<!-- define cylinder for spacecraft -->
    <tubs name="spacecraft" ROutREF="NADSpacecraftR" ZREF="NADSpacecraftZ"
          materialREF="spacecraftMat" />
<!-- next need to put together oneCAL and oneTKR with necessary
     structural stuff to make a tower.  Front plane of grid
     defines Z = 0 (Steve Ritz memo) -->

<!-- For now, just stack up oneCAL and oneTKR, then make a 4x4 array
     Need structural stuff 
    <stackZ name="oneTower" >
      <axisPos volume="oneCAL">
        <idField name="fTowerObjects" valueREF="eTowerCAL" />
      </axisPos>
      <axisPos volume="oneTKR" gapREF="calTrackerGap" >
        <idField name="fTowerObjects" valueREF="eTowerTKR" />
      </axisPos>
    </stackZ>

  -->

<!-- Add grid pieces.  There will be 4 per-tower
    grid web pieces and 4 per-tower grid flange pieces.  Then
    when all 16 towers have been assembled, will need to add on
    4 extra pieces of each type since width of grid around the
    outside is greater than the internal half-widths -->
    <box name="towerGridFlangeLong" 
      XREF="NADGridLenLong" YREF="NADGridFlangeInnerHalf" 
      ZREF="NADGridFlangeZ" 
      materialREF="CALGridMat">
    </box>

    <box name="towerGridFlangeShort" 
      XREF="NADGridFlangeLenShort" YREF="NADGridFlangeInnerHalf" 
         ZREF="NADGridFlangeZ" 
         materialREF="CALGridMat">
    </box>
    <box name="towerGridWebLong" 
      XREF="NADGridLenLong" YREF="NADGridWebInnerHalf" 
      ZREF="NADGridWebZ" 
      materialREF="CALGridMat">
    </box>

    <box name="towerGridWebShort" 
      XREF="NADGridWebLenShort" YREF="NADGridWebInnerHalf" 
         ZREF="NADGridWebZ" 
         materialREF="CALGridMat">
    </box>

<!-- Large grid flange boxes -->
    <box name="LATGridFlangeShort" 
         XREF="NADGridFlangeOutsideLenShort"
         YREF="NADGridFlangeOutsideWidth"
         ZREF="NADGridFlangeZ"
         materialREF="CALGridMat" />

    <box name="LATGridFlangeLong" 
         XREF="NADGridFlangeWidth"
         YREF="NADGridFlangeOutsideWidth"
         ZREF="NADGridFlangeZ"
         materialREF="CALGridMat" />

<!-- Large grid web boxes -->
    <box name="LATGridWebShort" 
         XREF="NADGridWebOutsideLenShort"
         YREF="NADGridWebOutsideWidth"
         ZREF="NADGridWebZ"
         materialREF="CALGridMat" />

    <box name="LATGridWebLong" 
         XREF="NADGridWebWidth"
         YREF="NADGridWebOutsideWidth"
         ZREF="NADGridWebZ"
         materialREF="CALGridMat" />


<!-- Note dimensions of oneTower envelope will (should) be
       towerPitch for X and Y
       CALVertStayClear + TKRVertStayClear + calTrackerGap  for Z  -->

    <box name="oneTowerEnv"
         XREF="towerPitch"
         YREF="towerPitch"
         ZREF="towersTotalZ"
         materialREF="vacuumMat"
         />
    <composition name="oneTower" envelope="oneTowerEnv">
      <posXYZ volume="oneTKR"
              ZREF="TKR_dz" >
        <idField name="fTowerObjects" valueREF="eTowerTKR" />
      </posXYZ>

      <!-- Flange pieces -->
      <posXYZ volume="towerGridFlangeLong"
              ZREF="gridFlange_dz"
              YREF="gridFlange_dt" >
        <idField name="fTowerObjects" valueREF="eTowerGrid" />
        <idField name="fGridObjects" value="0" />
      </posXYZ>

      <posXYZ volume="towerGridFlangeLong"
              ZREF="gridFlange_dz"
              YREF="gridFlange_dtn" >
        <idField name="fTowerObjects" valueREF="eTowerGrid" />
        <idField name="fGridObjects" value="1" />
      </posXYZ>

      <posXYZ volume="towerGridFlangeShort"
              zrot="90"
              ZREF="gridFlange_dz"
              XREF="gridFlange_dt" >
        <idField name="fTowerObjects" valueREF="eTowerGrid" />
        <idField name="fGridObjects" value="2" />
      </posXYZ>

      <posXYZ volume="towerGridFlangeShort"
              zrot="90"
              ZREF="gridFlange_dz"
              XREF="gridFlange_dtn" >
        <idField name="fTowerObjects" valueREF="eTowerGrid" />
        <idField name="fGridObjects" value="3" />
      </posXYZ>

<!-- grid web pieces -->
      <posXYZ volume="towerGridWebLong"
              ZREF="gridWeb_dz"
              YREF="gridWeb_dt" >
        <idField name="fTowerObjects" valueREF="eTowerGrid" />
        <idField name="fGridObjects" value="4" />
      </posXYZ>

      <posXYZ volume="towerGridWebLong"
              ZREF="gridWeb_dz"
              YREF="gridWeb_dtn" >
        <idField name="fTowerObjects" valueREF="eTowerGrid" />
        <idField name="fGridObjects" value="5" />
      </posXYZ>

      <posXYZ volume="towerGridWebShort"
              zrot="90"
              ZREF="gridWeb_dz"
              XREF="gridWeb_dt" >
        <idField name="fTowerObjects" valueREF="eTowerGrid" />
        <idField name="fGridObjects" value="6" />
      </posXYZ>

      <posXYZ volume="towerGridWebShort"
              zrot="90"
              ZREF="gridWeb_dz"
              XREF="gridWeb_dtn" >
        <idField name="fTowerObjects" valueREF="eTowerGrid" />
        <idField name="fGridObjects" value="7" />
      </posXYZ>

      <posXYZ volume="oneCAL"
              ZREF="CAL_dz" >
        <idField name="fTowerObjects" valueREF="eTowerCAL" />
      </posXYZ>
    </composition>


<!-- This doesn't behave well w.r.t. ids, but just ignore that for
     now to get a full LAT assembled.  In reality once structural
     entities are properly dealt with, probably won't be able to use
     stacks to put the towers together. -->
  
    <stackX name="towerRow" >
      <axisMPos volume="oneTower" ncopyREF="xNum" shiftREF="towerPitch"> 
        <idField name="fTowerX" value="0" step="1" />
      </axisMPos>
    </stackX>

    <stackY name="allTowers" >
      <axisMPos volume="towerRow" ncopyREF="yNum"  shiftREF="towerPitch">
        <idField name="fTowerY" value="0" step="1" />
      </axisMPos>
    </stackY>

&ACDAcd;


<!-- Make a LAT.  Still need an idField for tape components -->
    <composition name="LAT" envelope="LATenv" >
      <posXYZ volume="ACDTop"
              ZREF="ACDTop_d" >
        <idField name="fLATObjects" valueREF="eLATACD" />
        <idField name="fACDFace" valueREF="eACDTopFace" />
      </posXYZ>
      <!--posXYZ volume="allTowers" 
              ZREF="allTowers_d" -->
      <posXYZ volume="allTowers" 
              ZREF="towers_dz" >
        <idField name="fLATObjects" valueREF="eLATTowers" />
      </posXYZ>

<!-- Add in the rest of the grid web and flange (outside the towers) -->
      <posXYZ volume="LATGridFlangeLong" 
              YREF="LATGridFlange_dt"
              ZREF="NADGridFlangeZ" >
        <idField name="fLATObjects" valueREF="eLATGrid" />
        <idField name="fGridObjects" value="0" />
      </posXYZ>

      <posXYZ volume="LATGridFlangeLong" 
              YREF="LATGridFlange_dtn"
              ZREF="NADGridFlange_dz" >
        <idField name="fLATObjects" valueREF="eLATGrid" />
        <idField name="fGridObjects" value="1" />
      </posXYZ>

      <posXYZ volume="LATGridFlangeShort" 
              zrot="90"
              XREF="LATGridFlange_dt"
              ZREF="NADGridFlange_dz" >
        <idField name="fLATObjects" valueREF="eLATGrid" />
        <idField name="fGridObjects" value="2" />
      </posXYZ>

      <posXYZ volume="LATGridFlangeShort" 
              zrot="90"
              XREF="LATGridFlange_dtn"
              ZREF="NADGridFlange_dz" >
        <idField name="fLATObjects" valueREF="eLATGrid" />
        <idField name="fGridObjects" value="3" />
      </posXYZ>

<!--  now for big web pieces -->
      <posXYZ volume="LATGridWebLong" 
              YREF="LATGridWeb_dt"
              ZREF="NADGridWeb_dz" >
        <idField name="fLATObjects" valueREF="eLATGrid" />
        <idField name="fGridObjects" value="4" />
      </posXYZ>

      <posXYZ volume="LATGridWebLong" 
              YREF="LATGridWeb_dtn"
              ZREF="NADGridWeb_dz" >
        <idField name="fLATObjects" valueREF="eLATGrid" />
        <idField name="fGridObjects" value="5" />
      </posXYZ>

      <posXYZ volume="LATGridWebShort" 
              zrot="90"
              XREF="LATGridWeb_dt"
              ZREF="NADGridWeb_dz" >
        <idField name="fLATObjects" valueREF="eLATGrid" />
        <idField name="fGridObjects" value="6" />
      </posXYZ>

      <posXYZ volume="LATGridWebShort" 
              zrot="90"
              XREF="LATGridWeb_dtn"
              ZREF="NADGridWeb_dz" >
        <idField name="fLATObjects" valueREF="eLATGrid" />
        <idField name="fGridObjects" value="7" />
      </posXYZ>


      <posXYZ volume="TileXSide"
              XREF="ACDSideDovetail_d"
              YREF="tileXSide_dy"
              ZREF="tileSide_dz" >
        <idField name="fLATObjects" valueREF="eLATACD" />
        <idField name="fACDFace" valueREF="eACDXPosFace" />
      </posXYZ>
      <posXYZ volume="TileXSide" 
              XREF="ACDSideDovetail_dn"
              YREF="tileXSide_dyN"
              ZREF="tileSide_dz" >
        <idField name="fLATObjects" valueREF="eLATACD" />
        <idField name="fACDFace" valueREF="eACDXNegFace" />
      </posXYZ>
      <posXYZ volume="TileYSide" 
              XREF="tileYSide_dx"
              YREF="ACDSideDovetail_dn"
              ZREF="tileSide_dz" >
        <idField name="fLATObjects" valueREF="eLATACD" />
        <idField name="fACDFace" valueREF="eACDYPosFace" />
      </posXYZ>
      <posXYZ volume="TileYSide" 
              XREF="tileYSide_dxN"
              YREF="ACDSideDovetail_d"
              ZREF="tileSide_dz" >
        <idField name="fLATObjects" valueREF="eLATACD" />
        <idField name="fACDFace" valueREF="eACDYNegFace" />
      </posXYZ>
      <posXYZ volume="sideTapeRowX" 
              XREF="ACDSideDovetail_d"
              YREF="tapeXSide_dy"
              ZREF="tapeSide_dz" />
      <posXYZ volume="sideTapeRowX"
              XREF="ACDSideDovetail_dn"
              YREF="tapeXSide_dyN"
              ZREF="tapeSide_dz" />
      <posXYZ volume="sideTapeRowY"
              XREF="tapeYSide_dx"
              YREF="ACDSideDovetail_dn"
              ZREF="tapeSide_dz" />
      <posXYZ volume="sideTapeRowY"
              XREF="tapeYSide_dxN"
              YREF="ACDSideDovetail_d"
              ZREF="tapeSide_dz" />

      <!-- Finally position blanket pieces -->
      <posXYZ volume="blanketTop"
              ZREF="NADBlanketTop_dz" >
        <idField name="fLATObjects" valueREF="eLATBlanket" />
        <idField name="fBorderCmp" valueREF="eCenter" />
      </posXYZ>

      <posXYZ volume="blanketXSide"
              YREF="NADBlanket_dy"
              ZREF="NADBlanketSides_dz" >
        <idField name="fLATObjects" valueREF="eLATBlanket" />
        <idField name="fBorderCmp" valueREF="eRight" />
      </posXYZ>
      <posXYZ volume="blanketXSide"
              YREF="NADBlanket_dyn"
              ZREF="NADBlanketSides_dz" >
        <idField name="fLATObjects" valueREF="eLATBlanket" />
        <idField name="fBorderCmp" valueREF="eLeft" />
      </posXYZ>

      <posXYZ volume="blanketYSide"
              XREF="NADBlanket_dx"
              ZREF="NADBlanketSides_dz" >
        <idField name="fLATObjects" valueREF="eLATBlanket" />
        <idField name="fBorderCmp" valueREF="eTop" />
      </posXYZ>
      <posXYZ volume="blanketYSide"
              XREF="NADBlanket_dxn"
              ZREF="NADBlanketSides_dz" >
        <idField name="fLATObjects" valueREF="eLATBlanket" />
        <idField name="fBorderCmp" valueREF="eBottom" />
      </posXYZ>

      <posXYZ volume="spacecraft"
              ZREF="spacecraft_dz">
        <idField name="fLATObjects" valueREF="eLATSpacecraft" />
      </posXYZ>


    </composition>
  </section>
</gdd>
